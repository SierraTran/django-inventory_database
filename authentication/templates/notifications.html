{% extends "authentication_base_template.html" %}
{% load static %}

{% block other_stylesheets %}

{% endblock other_stylesheets %}

{% block title %}Notifications{% endblock title %}

{% block other_scripts %}  

document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll("input[type=checkbox]").forEach((checkbox) => {
        checkbox.addEventListener("change", function () {
            const notificationId = this.value; // Get the notification ID from the checkbox value
            const isRead = this.checked; // Check if the checkbox is checked

            fetch(`/notifications/${notificationId}/toggle_read/`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value, // CSRF token
                },
                body: JSON.stringify({ is_read: isRead }), // Send the read status in the request body
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log(data.message); // Optional: Handle the response (e.g., show a success message)
            })
            .catch(error => {
                console.error('Error:', error); // Handle errors
            });
        });
    });
});

{% endblock other_scripts %}

{% block page-title %}Notifications{% endblock page-title %}

{% block content %}
{% if notifications_list %}
{# TODO: Button for marking notifications as read #}
{# TODO: Button for deleting notifications #}
<form id="notifications-form" > {% csrf_token %}
<table>
    <tr>
        <th>Read</th>
        <th>Date & Time</th>
        <th>Subject</th>
        <th>Message</th>
    </tr>
    {% for notification in notifications_list %}
    <tr {% if not notification.is_read %}style="font-weight: bold;"{% endif %}>
        <td>
            {% if notification.is_read %}{% endif %}
            <button 
                type="button" 
                {% if notification.is_read %}checked{% endif %}>
                Mark as Read
        </button>
        </td>
        <td>{{ notification.timestamp }}</td>
        <td>{{ notification.subject }}</td>
        <td>{{ notification.message|safe }}</td>
    </tr>
    {% endfor %}
</table>
</form>
{% else %}
<p>There are no notifications.</p>
{% endif %}
{% endblock content %}